---
RecipeTemplateVersion: '2020-01-25'
ComponentName: EvergreenKernel
Description: Evergreen kernel
Publisher: Me
Version: '1.0.0'
Parameters:
- name: jvmOptions
  value: -Xms512m -Xmx512m
  type: STRING
- name: kernelRoot
  value: "/"
  type: STRING
Artifacts:
  # TODO: add artifacts
Lifecycle:
  bootstrap:
    posix:
      script: |-
        set -euo pipefail
        # TODO: Until {{kernel.root}} is available
        # KERNEL_ROOT="{{artifacts:path}}/../../../.."
        KERNEL_ROOT={{params:kernelRoot.value}}
        unzip "{{artifacts:path}}/EvergreenKernel-1.0.0.zip" -d "$KERNEL_ROOT/lib/"
        mv -f $KERNEL_ROOT/alts/current $KERNEL_ROOT/alts/old
        mkdir $KERNEL_ROOT/alts/current
        echo "{{params:jvmOptions.value}}" > $KERNEL_ROOT/alts/current/launch.params
        ln -sf "../../lib/EvergreenKernel-1.0.0" $KERNEL_ROOT/alts/current/distro
        exit 100


