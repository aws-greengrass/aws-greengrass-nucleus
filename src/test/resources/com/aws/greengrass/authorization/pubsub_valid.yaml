---
services:
  main:
    dependencies:
      - mqtt
      - ServiceName
    lifecycle:

  mqtt:
    lifecycle:
    parameters:
      accessControl:
        aws.greengrass.ipc.pubsub:
          policyId1:
            policyDescription: access to pubsub topics 1
            operations:
              - publish
              - subscribe
            resources:
              - /topic/1/#
              - /longer/topic/example/
          policyId2:
            policyDescription: access to pubsub topics 2
            operations:
              - publish
            resources:
              - /publishOnlyTopic
        testComponent:
          policyId3:
            policyDescription: access to secrets
            operations:
              - getsecret
            resources:
              - secret1

  ServiceName:
    resources:
      - http-resource
    lifecycle:
      run:
        windows:
          powershell -command sleep 100
        posix:
          sleep 100
    parameters:
      accessControl:
        aws.greengrass.ipc.pubsub:
          policyId4:
            policyDescription: access to pubsub topics 4
            operations:
              - publish
              - subscribe
            resources:
              - /topic/1/#
              - /longer/topic/example/
              - '*'