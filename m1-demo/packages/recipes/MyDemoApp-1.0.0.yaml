---
RecipeTemplateVersion: '2020-01-25'
PackageName: MyDemoApp
Description: A demo app
Publisher: Me
Version: '1.0.0'
Parameters:
- name: sampleText
  value: This is a test
  type: STRING

Lifecycle:
  install:
    script: |-
      # pip install greengrasssdk # need to run as root
  checkIfSafeToUpdate:
    recheckPeriod: 5
    script: |-
      SAFE_TO_UPDATE=$(curl localhost:8080/safeToUpdate)
      if [ "$SAFE_TO_UPDATE" = "true" ]; then
          echo "Safe to update"
          exit 0
      else
          echo "Not safe to update " + $SAFE_TO_UPDATE
          exit 1
      fi
  run:
    script: |-
      python3 {{artifacts:path}}/myDemoApp.py

Dependencies:
  all:
    MyObjectClassificationModel:
      VersionRequirements: '1.0.0'
      DependencyType: SOFT
