---
RecipeTemplateVersion: '2020-01-25'
PackageName: HomeSecurityApp
Description: Home Security Monitoring. Part 5.
Publisher: Ethan Huang
Version: '0.1.15'
Platforms:
- 'debian'

Parameters:
- name: color
  type: STRING
  value: red

Lifecycle:
  install:
    debian: |-
      pip3 install https://dl.google.com/coral/python/tflite_runtime-2.1.0.post1-cp37-cp37m-linux_armv7l.whl
      # part3 and above
      pip3 install greengrasssdk
  run:
    debian: python3 {{artifacts:path}}/detect_picamera.py --color {{params:color.value}} --model {{artifacts:path}}/detect.tflite --label {{artifacts:path}}/coco_labels.txt

  # Part5.prepare
  checkIfSafeToUpdate:
    debian:
      recheckPeriod: 5
      script: raspistill -t 1 -o test.img

Dependencies:
  debian:
    StreamManager:
      VersionRequirements: '0.9.10'
      DependencyType: Hard
Artifacts:
  debian:
  - "greengrass:annotation.py"
  - "greengrass:coco_labels.txt"
  - "greengrass:detect.tflite"
  - "greengrass:detect_picamera.py"
  - "greengrass:mobilenet_ssd_v2_coco_quant_postprocess_edgetpu.tflite"
  - "greengrass:streamManagerHelper.py" # Part3 and above
